[qwertyu]: {{ "/assets/2017-11-02-wormholes/blackholes_wormhole.jpg" | absolute_url }}

![alt text][qwertyu]{: .center-image }

other text

Test text
{: style="color:gray; font-size: 80%; text-align: center;"}

# IFR lesson

# lesson structure

1. [***intro***](#1)
    1. [**flashforward to experiment**](#1.1)
        1. [goals](#1.1.1)
        1. [results](#1.1.2)
    1. [what is PET, real quick](#1.2)
    1. [structure of the lecture](#1.3)
1. [***theoretical concepts***](#2)
    1. [**What is a PET scanner?**](#2.1)
        1. [Physical mechanism behind the process](#2.1.1)
        1. [Detectors used](#2.1.2)
        1. [The signal obtained](#2.1.3)
        1. [Uses / Types of PET](#2.1.4)
    1. [**How well does it work?**](#2.2)
        1. [Types of Coincidence Events](#2.2.1)
        1. [Discriminating the correct signal](#2.2.2)  
        1. [PET performance characteristics](#2.2.3)
1. [***lab application***](#3)
    1. [The easyPET](#3.1)
    1. [Our goals and procedures](#3.2)
    1. [Raw data](#3.3)
    1. [Processing the raw data](#3.4)
    1. [Results](#3.5)
    1. [Conclusions about the results](#3.6)
    1. [Remarks](#3.7)
1. [***concluison***](#4)

#<a name= "1">1. Intro</a>

## <a name = "1.1">1.1. The experiment </a> 

So we chose the PET experiment because it seemed fun and like an opportunity to learn something with a few practical applications that may be tangentially related to IFR. Basically we saw that the experiment was about PET and decided that that's what we want to do.

#### <a name = "1.1.1">1.1.1. Goals </a>

[properPET1]:       {{ "/assets/2017-11-05-PET/ct-celesteion-overview-accuracy-2.png" | absolute_url }}
[properPET2]:       {{ "/assets/2017-11-05-PET/f2big.png" | absolute_url }}
[easyPET1]:         {{ "/assets/2017-11-05-PET/IMG_20171012_152431.jpg" | absolute_url }}
[easyPETsoftware]:  {{ "/assets/2017-11-05-PET/IMG_20171012_151940.jpg" | absolute_url }}
[easyPETtopBottom]: {{ "/assets/2017-11-05-PET/topBottom.jpg" | absolute_url }}
[easyPETeasy]:      {{ "/assets/2017-11-05-PET/easy.jpg" | absolute_url }}

We were sort of expecting that there would be a clear goal to the experiment, some measurement that we had to make in the end, however that's not really the case here. Basically the goal of our experiment was to ***work it***. "It" being the PET scanner in this case. Speaking of the PET scanner, going in we were kind of expecting a proper installation. As in, something of this sort:

![alt text][properPET1]{: .center-image }
![alt text][properPET2]{: .center-image }

Not this:

![alt text][easyPET1]{: .center-image }
![alt text][easyPETsoftware]{: .center-image }
![alt text][easyPETtopBottom]{: .center-image }
![alt text][easyPETeasy]{: .center-image }

Admittedly our expectations may have been a tad too high. Now the simple goal of getting it working made a lot more sense. Given the amount of freedom we were given with this experiment we chose to expand that goal a little bit. We were originally hoping to test the performance characteristics of the easyPET based on the standards of the trade (we'll look into those eventually), but that would require the correct shape of phantom, decent activity, and more generally we'd need access to <s>the appropriate</s> equipment. Instead we opted to get it working and make sure that the easyPET could be used in future experiments here at the DF.

#### <a name = "1.1.2">1.1.2. Results </a>

[processed600mVBoxSrc]: {{ "/assets/2017-11-05-PET/processed.png" | absolute_url }}

Check it out:

![alt text][processed600mVBoxSrc]{: .center-image }

I'd say it worked out. How about you? What, you disagree? You neither agree nor disagree... Oh, you don't know enough about PET scanners to provide an informed opinion and therefore showing you some pretty images ultimately doesn't inform you of anything, and therefore you aren't able to provide any feedback, that's what's happening? Guess we should swing back a bit then...

## <a name= "1.2">1.2. What Are we Even Talking About? </a>

[petSlice]: {{ "/assets/2017-11-05-PET/petScanPictures3.jpg" | absolute_url }}
[petVoxel]: {{ "/assets/2017-11-05-PET/rat-mri-enlarge.jpg" | absolute_url }}


PET stands for Positron Emission Tomography. It's often also the term used to describe the scanner that uses this principle. What PET scanners do is that they register  the simultaneous detection of the two electron-positron annihilation (\\(e^{+} + e^{-} \rightarrow \gamma + \gamma\\)) gammas -- generally by way of an entire ring of scintillation detectors -- the positron having been originally emitted by a source of \\(\beta^{+}\\) radiation. Then the scanners do that over a very large number of decays in order to generate a map of the density of radioactive material across a 2D slice of space. The slice may just happen to be a patient, and the source of \\(\beta^{+}\\) radiation may just happen to have gotten where it is through prior injection.

![alt text][petSlice]{: .center-image }

Also it may or may not be common to have several rings forming a cylindrical shell of detectors in order to obtain several 2D slices that neatly stack up to form a 3D voxel dataset.

![alt text][petVoxel]{: .center-image }

But don't quote me on that. Also I'm guessing you already knew this. Tell you what, here's what we're gonna do. Wait, lemme change sections first.

## <a name= "1.3">1.3. Structure of the Lecture </a>

We'll start by discussing stuff that you already know about PET scanners and we'll keep talking about them until we reach topics that you pr \obably didn't know previously. Then we'll continue talking. For a while. It might be interesting. That's the first half of the lecture. The second half will be about our experiment per se. When we get to the second half we'll talk about the structure of that one as well, but we're getting ahead of ourselves here. The first half will focus on going into detail about answering two questions: what is a PET scanner, and how good are they? Given what we've talked about so far, one can infer that the answer to the first question will have the following components:

- the physical mechanism that PET exploits
- detectors used and their configuration
- data obtained and image reconstruction
- uses of the PET scanner / types of PET scanner

Once we know what the PET scanner is, we will know what questions to ask if we want to find out how good they are, so we'll lay out the structure of the answer to that question once we're done answering the first one. But for that we first need to know what a PET scanner is.

# <a name= "2">2. Theoretical Concepts</a>

## <a name= "2.1">2.1. What is a PET scanner?</a>

[coolImage]:    {{ "/assets/2017-11-05-PET/PETscanSchematic.jpg" | absolute_url }}
[mousePETscan]: {{ "/assets/2017-11-05-PET/G8_PET-CT-Imaging-Mouse-Web.jpg" | absolute_url }}

A PET scanner is one of those big things with (usually) a ring, or cylindrical shell, of scintillation detectors -- like the one we showed at the start of the lecture -- and its output is an image of the spacial density of material emitting positrons inside a test subject. These contraptions can be used for stuff like detecting cancers and neuroimaging, more on that later (but only slightly more, this is not biomed eng. ffs). This is roughly how they work:

![alt text][coolImage]{: .center-image }

IMPROVE THIS IMAGE, THE CURRENT VERSION IS TRASH
{: style="color:gray; font-size: 80%; text-align: center;"}

As we can see there's four components to its function:

1. ***Tracer***
    - The positron-emitting material. [They are chemical compounds in which one or more atoms have been replaced by a short-lived, positron emitting radioisotope](https://en.wikipedia.org/wiki/List_of_PET_radiotracers). They spread through the body after injection and can be chosen so as to concentrate on specific features. Here's a quick example of how that can  be used: so one of the most common tracers is fludeoxyglucose (\\({}^{18}\textrm{F}\\)) (CITATION NEEDED), aka \\({}^{18}\textrm{F}\\)-FDG or just FDG, right? Well, one of the reasons why it's so useful is that it's a structural analog of glucose, meaning that their uptakes are correlated (CITATION NEEDED), and therefore cells that use a lot of glucose -- one of the few that do that being cancer cells -- they will take up a lot of FDG as well. [Once the FDG has been absorbed by a cell, phosphorylation prevents it from being released again,](https://en.wikipedia.org/wiki/Fludeoxyglucose_(18F)#Mechanism_of_action.2C_metabolic_end-products.2C_and_metabolic_rate) meaning that it will collect on features like tumors and such, i.e. there will be a higher spatial density of FDG around them. Now we just need some device -- like a scanner of some sort -- that could indicate what that spacial density is, maybe with the help of the resulting positron emission, and we've got a ourselves a full-fledged cancer detector! Now if only someone could invent that....
1. ***Detectors***
    - These detect radioactive decays, including -- but not limited to -- those of the tracer. Generally they are a scintillator / photomultiplier combo of some sort.
1. ***Coincidence Electronics***
    - Makes sure that the decay is a positron decay, probably originating from the tracer. If the electronics detect a *coincidence* event -- that's the name for when two photons are captured in two roughly opposite scintillators within a certain time window -- then the estimated direction of the two photons is registered for image reconstruction.
1. ***Image Reconstruction***
    - Processes the information obtained from the coincidence electronics in order to reconstruct the spacial density of tracer.

So to recap the mouse is given some radioactive tracer molecules. These will then collect on some feature we're interested in detecting. There they will decay, the decays get registered on the detectors, the coincidence electronics discriminates those decays from noise and helps to estimate the source of the decay, and finally the image reconstruction will take in that information and return a slice (aka a tomography) that indicates where the decays originate. So something like this:

![alt text][mousePETscan]{: .center-image }

As we can see, the computer they were working with in the other diagram probably froze at some point, because what it's showing is clearly a brain scan. Also the mouse looks like it's on a sled inside the PET scanner. From all the research we've done for this lecture we have found no indication that it is necessary for mice to be on sleds inside a PET scanner. Not to mention that that is its tail. Also the mouse is NOT running inside the PET scanner.

Anyway, now that you know what a PET scanner is, you're probably wondering how all this actually works and is interconnected. Namely, throughout this section we've been deliberately omitting some very important details about the work principle of the PET scanner. For instance:

- **q.A:** How does PET scanner know that is positron decay?
- **q.B:** How does it know what location the decay originated from?

Thoughout the following subsections we will work our way towards an answer to these two questions. Starting from the absolute basics -- the physical process at play -- and moving through how the decay is detected, up to AN EXAMPLE OF(?) how it is later reconstructed.

Before we move on, another quick remark. You might catch yourself wondering -- and this is a thing that happened to us during the course of our work -- you might catch yourself wondering who even came up with this stuff <s> and what were they on</s>. The history of the PET scanner is a topic that may be worth mentioning real quick, but we'll leave its discussion almost till the end, because by then you'll have a better understanding of what obstacles came in the way of its development, also because it will serve as a good segue into the section about how good PET scanners are, but most importantly because you're probably more interested in looking at the physics and instrumentation behind the scanner at this point. So let's address that now, starting with q.A.

#### <a name = "2.1.1">2.1.1. Physical mechanism behind the process</a>

[glucose]:               {{ "/assets/2017-11-05-PET/Alpha-D-glucopyranose-2D-skeletal.png" | absolute_url }}
[FDG]:                   {{ "/assets/2017-11-05-PET/Fluorodeoxyglucose_18-F_skeletal.svg.png" | absolute_url }}
[18Fdecay]:              {{ "/assets/2017-11-05-PET/800px-F18_DS1.png" | absolute_url }}
[positronKineticEnergy]: {{ "/assets/2017-11-05-PET/18FpositronKineticEnergy.png" | absolute_url }}
[epAnnihilationFeynman]: {{ "/assets/2017-11-05-PET/640px-Feynman_EP_Annihilation.svg.png" | absolute_url }}
[epAnnihilation]:        {{ "/assets/2017-11-05-PET/main-qimg-a4b1776e6a338cb836e591602ac782a1-c.jpg" | absolute_url }}
[positronCrossSection]:  {{ "/assets/2017-11-05-PET/peAnnihilationCrossSection.png" | absolute_url }}
[positronRangeWater]:    {{ "/assets/2017-11-05-PET/positronRangeWater.png" | absolute_url }}
[H2OgammaAttenuation]:   {{ "/assets/2017-11-05-PET/H2OgammaAttenuation.png" | absolute_url }}
[fullMechanism]:         {{ "/assets/2017-11-05-PET/Annihilation.png" | absolute_url }}
[PETonWheels]:           {{ "/assets/2017-11-05-PET/PETonWheels.png" | absolute_url }}
[noncolinearity]:        {{ "/assets/2017-11-05-PET/noncolinearity.png" | absolute_url }}
[mechanismLargeScale]:   {{ "/assets/2017-11-05-PET/mechanismLargeScale.png" | absolute_url }}
[mechanismLargerScale]:  {{ "/assets/2017-11-05-PET/mechanismLargerScale.png" | absolute_url }}
[orange]:                {{ "/assets/2017-11-05-PET/orange.png" | absolute_url }}

So we agreed to start this discussion by asking ourselves how the PET scanner knows that what it's dealing with is a positron decay. Let's back up a bit and talk about that tracer FDG for a moment, we want to make a silky smooth transition here. So FDG was a glucose analog, right? Here they are side by side:

 ![alt text][glucose]{: .center-image }  | ![alt text][FDG]{: .center-image }
 |:--:|:--:|
 **glucose**{: style="color:gray; font-size: 80%; text-align: center;"} | **FDG**{: style="color:gray; font-size: 80%; text-align: center;"}
 
So save for the fluorine-18 in place of the hydroxyl group in the C-2 position, these two molecules are the same, so the thing that makes FDG a tracer must be the fluorine. Let's look at the fluorine-18's decay scheme:

![alt text][18Fdecay]{: .center-image }

Ok, so by far the most likely decay to happen is this one:

$$
{}_{18}^{9}\textrm{F} \rightarrow {}_{18}^{8}\textrm{O} + e^{+} + \nu_{e}
$$

Yep, there's the positron we were expecting. [By the way, a typical Q-value is of about 1 MeV](https://en.wikipedia.org/wiki/Beta_decay#Energy_release), which means that that Q-value of 0.633 MeV we have there is more on the lower side of the things, resulting in a slower than usual positron at the outset: 

![alt text][positronKineticEnergy]{: .center-image }

*source: C. S. Levin, E. J. Hoffman, Phys. Med. Biol. 44 (1999) 781–799.*
{: style="color:gray; font-size: 80%; text-align: center;"}

For a tracer, that's a very good characteristic, but before we can continue the discussion of why that is we need to clear up one thing: what actually is electron-positron annihilation?

Well, presented in a way that won't be too boring for people who are already familiar with the concept, here it is:

![alt text][epAnnihilationFeynman]{: .center-image }

If the initial particles are at rest, then the total energy of the two photons is obviously \\(M_{f} = m_{\gamma 1}+ m_{\gamma 2} = M_{i}=2m_{e} = 2\times 511 \textrm{keV}\\).

[As for the virtual particle, if you're wondering why it's even there and why it's an electron, here's the reason for that. First of all, photons are gauge bosons of the electromagnetic force, and U(1) symmetry -- which is the symmetry principle that leads to QED -- produces only 3-particle vertices, meaning that you can't represent electron-positron annihilation with a 4-particle vertex. As for why the virtual particle has to be an electron, that's because each vertex must represent a possible interaction.](https://www.physicsforums.com/threads/feynman-diagram-of-electron-and-positron-annihilation.621408/) That's as far as we go with Feynman diagrams here, probably for the better. Now for the need for 2 photons rather than going by with just one. We probably all know the reason for that by now, but for the sake of completion let's explain that through a very quick example anyway. Suppose the electron and positron are at rest when they annihilate. Let's also say that a single photon is created in the process. That would mean that, since \\(E_{\gamma} \sim p_{\gamma}\\), we would have to require massless electrons in order for there to be conservation of momentum between the initial system and the final one. That won't do. But if we have the creation of two photons instead, then we can conserve momentum as long as the photons are emitted at equal energies in opposite directions. Keep a mental note of that, because it just so happens to be the the fundamental mechanism behind why PET scanners are even a thing. Naturally we can then extend this argument to any system with net zero momentum, by way of simply increasing the energy of the resulting photons. So we get something like this:

![alt text][epAnnihilation]{: .center-image }

Then we can extend the argument further to include all inertial systems and say that if electron-positron annihilation requires the creation of two photons whenever the system has net zero momentum in the CM referential -- which is, like, always -- then those two photons will have to exist in the LAB referential as well. So that's electron-positron annihilation explained. However keep in mind that now that we don't have the condition of a net-zero momentum initial system, we need to correct the energy and direction of the resulting photons, we no longer necessarily get that neat 180º angle between the two. We'll soon see that that's not *too* important in our case and we can almost assume that the photons are still going in exactly opposite directions, but for now keep in mind the need for corrections.

Ok, back to the story about tracers. Here's why a slow tracer is a good tracer:

For an incident positron of energy \\(E = \gamma mc^{2}\\) hitting an atomic electron, the cross-section for positron-electron annihilation per atom of atomic number \\(Z\\) that the positron collides with is given by the following expression\\([\\)[1](#Heitler)\\(]\\):

\\[
\sigma(E,Z) \propto
\frac{Z}{\gamma+1}
\left[\frac{\gamma^{2}+4\gamma+1}{\gamma^{2}-1}\,\textrm{ln}\left(\gamma + \sqrt{\gamma^{2}-1}\right)-\frac{\gamma+3}{\sqrt{\gamma^{2}-1}}\right]
\\]

The energy dependence, save for the units, has this shape:

![alt text][positronCrossSection]{: .center-image }

Notice real quick how the cross-section asymptotically rises for \\(x\equiv\gamma \rightarrow1\\), that'll come in handy in a bit. But before that, what this cross-section means is that before the electron-positron annihilation can happen, the positron must lose energy, which it will do via inelastic scattering with the atomic electrons (Levin and Hoffman, 1999), and the less energy it needs to lose from the outset, the closer the annihilation will happen to the original location of the \\(\beta^{+}\\) decay. Meanwhile the stopping power acting on the positron increases as it slows down. The result of this being that -- thanks to the low initial kinetic energy -- the positrons emitted by fluorine-18 have an average range in water of just 0.46 mm, which even for tracer isotopes is very close to the source. I mean, look at this:

![alt text][positronRangeWater]{: .center-image }

*source: G. B. Saha, Basics of PET Imaging 2nd Ed., Springer*
{: style="color:gray; font-size: 80%; text-align: center;"}

The other ones aren't too shabby either, mind you, even the isotope with the highest range has positrons move barely a centimeter away from the source. I mean, look at this as well:

![alt text][orange]{: .center-image }

*source: S. R. Cherry, M. Dahlbom, PET: Physics, Instrumentation and Scanners*
{: style="color:gray; font-size: 80%; text-align: center;"}

That's not the isotope with the highest range, I know, but that's what we found, and all the other graphs of this kind we found looked roughly like that as well. But regardless, there's hardly any competition as far as specs go. But ok, I agree that one thing that the table above shows is that any of the isotopes will have the positron annihilate pretty close to the source. So with any of these isotopes, if you can find where the positron annihilated with the electron, you will have found almost exactly the location where the positron originated in the first place.

In fact, with this piece of information, plus another two, we can understand why electron-positron annihilation is such a powerful resource for something like a tomography. So we've already established that the positrons annihilate with an electron rather close to the positron's isotope of origin, and that when the annihilation happens, the end result in the CM referential is a pair of photons of equal energy going in oppposite directions. That means that if we have a set of detectors in the same CM referential that detects the two opposing photons, then we'll be able to draw a line along their path and know that somewhere along that line there was an electron-positron annihilation. In other words, based on the range of the positrons we could then conclude that the decay happened within a blurry cylinder with the axis being the *Line Of Response (LOR)* -- that's the name of the line we've been referring to so far. If we assume that the electron is encased in an atom, it will likely be going slower than the positron, so this is roughly what the situation would look like:

![alt text][PETonWheels]{: .center-image }

The scintillators we found for this hypothetical experiment were LYSO, so that's why LYSO is written on them, we'll talk more about what that is later. What we see is that because we're in the CM referential we have to match the speed of our detectors to that of the positron, meaning that the rest of the LAB is whizzing by in the opposite direction. That's not very practical, especially considering that we expect more than one positron to be emitted -- isotropically, by the way -- over the course of the scan: we could try to inject a single molecule of FDG into the patient, but that's difficult and not particularly useful. That means that the best configuration is to have the PET scanner be stationary, rather than have it move on wheels to match the speed of the different positrons. I mean, that's pretty obvious, I don't even know why I brought it up. It does bring light to a potential problem we might face, though: what if the positrons are too fast when they get annihilated, and therefore the photons are emitted noncolinearly? While we're at it, let's list another potential problem: what if the photons get extremely attenuated by the patient? Both of these problems would render the mechanism we've been describing unusable for tomographies. So let's address them, the former one first.

Remember how the electron-positron cross-section would asymptotically rise for \\(\gamma \rightarrow 1\\)? Well, that means that the positron's kinetic energy as it annihilates with the electron will generally be very low, to the point that it's nearly at rest. It's low enough that the noncolinearity of the two photons has an FWHM of just 0.5º:

![alt text][noncolinearity]{: .center-image }

So noncolinearity may be an issue, but it doesn't render PET unusable. This also means that the two photons released will still have an energy of roughly 511 keV. What about photon attenuation by the patient?

Well, [96% of the human body mass consists of elements with \\(Z \leq 8\\), and 65% of the human body mass is thanks to oxygen, most of that oxygen coming from water.](https://en.wikipedia.org/wiki/Composition_of_the_human_body) As such we can make a pessimistic estimate of the photon attenuation by assuming that people are 100% water and then just looking up the attenuation of 511 keV photons in water.

Photon attenuation by a layer of thickness \\(t\\) and with a mass attenuation coefficient \\(\mu/\rho\\) is governed by this expression, in case you forgot:

\\[
I(t)/I_{0} = e^{-(\mu/\rho)\times\rho t}
\\]

Okay, let's see:

![alt text][H2OgammaAttenuation]{: .center-image }

For 511 keV photons that corresponds to a mass attenuation of roughly \\(0.1\, \textrm{cm}^{2}/\textrm{g}\\). Meanwhile the density of liquid water is \\(1\, \textrm{g}/\textrm{cm}^{3}\\), so the absorption length of photons in water is 10 cm. As a rough estimate, that gives us that the average adult will interact with about half of the photons they emit. Since we're interested in detecting two electron-positron annihilation photons where neither of them have interacted with the patient, our odds for a good detection decrease to 25% at the outset. I mean, that's not amazing, but it's serviceable nonetheless. We'll have to find ways to deal with the odds we're given.

The end result is a mechanism that looks something like this:

![alt text][fullMechanism]{: .center-image }

And since the photons don't always get attenuated before reaching the scintillator, we can use this to map out a LOR. And that's for a single decay! Remember that this mechanism happens isotropically over regions of a certain density of tracer, so what really happens is more akin to this:

![alt text][mechanismLargeScale]{: .center-image }

And we can map out multiple LORs! 

![alt text][mechanismLargerScale]{: .center-image }

In due time we'll have a detailed look at how the scanner distinguishes the real electron-positron annihilation events from bogus readings, but before we can get to that we'll look at the instrumentation used in these scanners. For now suppose that the simultaneous detection at two detectors is a sufficient criterion for registering a LOR. Later we will also briefly mention how the image reconstruction is done.

<a name="Heitler">\\([\\)1\\(]\\): W. Heitler, The Quantum Theory of Radiation, chap. IV, §21, p. 204 - 213 </a>

#### <a name = "2.1.2">2.1.2. Detectors used</a>

[mechanismLargerScaleZoom]: {{ "/assets/2017-11-05-PET/mechanismLargerScaleZoom.png" | absolute_url }}
[linearAttenuation]:        {{ "/assets/2017-11-05-PET/massAttenuatio.png" | absolute_url }}
[bandStructure]:            {{ "/assets/2017-11-05-PET/bandStructure.png" | absolute_url }}
[scintBandStruct]:          {{ "/assets/2017-11-05-PET/Energy+band+structure+of+an+activated+cystalline+scintillator.jpg" | absolute_url }}
[scintillatorTable]:        {{ "/assets/2017-11-05-PET/scintillatorTable.png" | absolute_url }}
[tumors]:                   {{ "/assets/2017-11-05-PET/333643_1_En_4_Fig7_HTML.gif" | absolute_url }}
[scintillatorOutput]:       {{ "/assets/2017-11-05-PET/scintillatorOutput.png" | absolute_url }}

So we saw earlier that about 25% of the annihilation events escape the patient in a pristine state. The rest of the time at least one of the two photons suffers an interaction. [Of those interactions, 99.7% are Compton scattering.](https://physics.nist.gov/cgi-bin/Xcom/xcom3_2) That means that our back-of-the-envelope calculations from earlier have become a lot more complicated: the overwhelming majority of annihilation photons will escape the patient, but 3/4 of the photon pairs contain at least one bogus photon going in a wrong direction. If those events get picked up, they need to be rejected somehow.

But we're getting ahead of ourselves. Let's get back to those 25% of good events: the photons have escaped the patient, and are now heading into oblivion. In order to know that an event happened we need there to be something between the patient and oblivion that will catch them. Like some form of detector or something. That's to say that now we're going to be talking about what are these things over here:

![alt text][mechanismLargerScaleZoom]{: .center-image }

Unlike in the patient, where we didn't want attenuation of the photons, now we absolutely do want it. So in order to obtain a 2D slice of the spacial density of radioactive decay we're looking to make a ring of detectors that would be sensitive to gamma rays. Gamma ray spectroscopy is done using either semiconductor detectors or inorganic crystal scintillation detectors. We're going to quickly look at the functioning principle of both of them in order to determine how well they'll apply to PET scanners. But before that let's look at the common characteristics behind the two types of spectroscopy.

In order to register a photon of a certain energy, the detector must be capable of absorbing all the energy of the photon and then converting it to an electrical signal. Look at this graaaph:

![alt text][linearAttenuation]{: .center-image }

*source: G. Gilmore, Practical Gamma-Ray Spectrometry, 2nd Edition*
{: style="color:gray; font-size: 80%; text-align: center;"}

As we can see the linear attenuation dips considerably as the photoelectric effect loses significance, and this happens across all materials. This means that in order for the detector to attenuate reasonably well it must be a solid detector. Beyond that, we can see that the attenuation increases with Z, or better yet, with effective Z. This means that we'd rather be using something like salt rather than a phone battery to capture the photons, although both options are far from ideal.

So that's the absorption part covered. Our conclusion is that we need a solid detector with high effective Z. What about converting that captured photon into an electrical signal? Now for that part not just any hunk of rock will do. It narrows our range of options down to just the aforementioned inorganic crystal scintillators and to semiconductor detectors. These two happen to be able to faithfully carry the energy of the photon onto a later stage without keeping it for themselves. Let's first look at how the semiconductors do it, since it's a more direct process there.

The transfer of the photon energy into the semiconductor is done by having the photon hit the semiconductor, resulting in a track of primary electrons and holes in the semiconducting material that get raised either from occupied bands or the valence band into the conduction band. We'll get back to the primaries in a bit.

So what happens in semiconductors is indicated on the rightmost image in the graph below:

![alt text][bandStructure]{: .center-image }

*source: G. Gilmore, Practical Gamma-Ray Spectrometry, 2nd Edition*
{: style="color:gray; font-size: 80%; text-align: center;"}

The conduction band of a semiconductor is very large and the band gap is quite small at just 1 eV. In fact, this band gap can be crossed even via thermal excitation. This means that the primary electrons in the conduction band can easily cause more electrons to escape the valence band. Each of those electrons also causes the formation of a hole that travels along the semiconductor. Long story short, each primary electron released along the photon track results in an avalanche of electron-hole pairs that can freely travel through the semiconductor. Then we can collect all these charge carriers by applying an electric field, resulting in an electrical signal. That's the basis of operation of semiconductor detectors. 

The clear upside that comes with the small band gap is the fantastic energy resolutions that are obtainable with semiconductor detectors, reaching resolutions as good as 0.145 keV in germanium detectors within their optimum range of 2-100 keV. However there is a downside with the fact that thermal excitation can raise the electrons into the conduction band. The probabilty that an electron will cross from the valence band into the conduction band is strongly related to this expression:

\\[
p(T)\propto T^{3/2}\textrm{exp}(-E_{g}/2kT),
\\]

where \\(k\\) is the Boltzmann constant. Basically this results in the signal being buried in the noise floor for anything other than cryogenic temperatures for most of the semiconductor materials. However there is one big exception that we'll look at once we've dealt with the second kind of detector used, that being the scintillator.

The mechanism for scintillator crystals is similar to that of semiconductors, but with a caveat. The crystals themselves have very large band gaps, so even if a primary electron were to deexcitate, which it would do very inefficiently, its energy would be too high to be visible. As such, the crystal is doped with an activator, which leaves activator excited states within the band gap that the conducted electrons can jump to and then easily deexcite from, forming deexcitation sites within the crystal from where photons in the visible spectrum (1.8 - 3.1 eV) get emitted:

![alt text][scintBandStruct]{: .center-image }

*source: G. F. Knoll, Radiation Detection and Measurement, 3rd Ed.*
{: style="color:gray; font-size: 80%; text-align: center;"}

In turn visible photons have an energy lower than that of the crystal band gap, meaning that the activator photons can now travel (mostly) freely through the crystal (MAKE SURE THAT?S TRUE, WILL VALENCE BAND AFFECT RESULT?) onto a further step.

So what we've done so far with the scintillator crystal was convert the high energy gamma photons into lower energy visible photons. We have yet to extract an electrical signal out of them, though. That is done next with the help of some photomultiplier. For that purpose both photomultiplier tubes and MPPCs are used. ([**CEDRIC, EXPLICA MPPCs E PMTs TALVEZ?**](a)) What they do is obtain some number of visible photons, which release primary photoelectrons from a photocathode, which will then cause an avalanche of electrons that will be translated to a corresponding electrical pulse. The height of the pulse correlates to the number of avalanches, which in turn correlates to number of visible activator photons hitting the photomultiplies, which in turn correlates to the energy of the photon hitting the scintillator. That way, by measuring the pulse height it is possible to distinguish between a good annihilation photon and a (strongly) scattered one.

Now let's look in more detail at some scintillator crystals in particular. Here's a table listing a few of them and their properties.

![alt text][scintillatorTable]{: .center-image }

*source: G. B. Saha, Basics of PET Imaging 2nd Ed., Springer*
{: style="color:gray; font-size: 80%; text-align: center;"}

Of the parameters listed in the table, the ones that will most affect the practicality of the scintillation crystal for the application of PET scanning are the following: 

- **linear attenuation coefficient** - the higher they are, the smaller the detector needs to be. This paramater is linked to the effective Z and the density of the material;
- **energy resolution** - the lower the percentage, the better the discrimination against scattered photons. This parameter is linked in part to the photon yield of the material;
- **decay time** - the lower it is, the higher the efficiency of detection for a high-activity sample.

In addition to these parameters it's also worth taking into consideration the ease of handling the material, as well as price of manufacture, but those parameters would have made the table too large and it wouldn't be readable at a 500px width.

Of the scintillators indicated above, the most commonly used is BGO, due to its high stopping power, however this sacrifices resolution considerably. LSO seems promising, but it has a its own naturally occuring radioisotope, which reduces resolution. LYSO is also gaining some popularity, but we'll talk more in depth about it later. 

The point is that regardless of the scintillator you choose, you either end up requiring a very large detector (like in the case of NaI, explaining why it is not popular in PET circles, or for YAP), or you end up with very poor energy resolution, in the range of 20% once the detector is inserted into a PET scanner.

All this makes semiconductor detectors an attractive alternative to scintillation detectors. As we mentioned, semiconductors have their own problem of requiring cryogenic temperatures in order to glean a signal out of them. But not for CdTe (cadmium telluride), though. CdTe works well at temperatures of just -30ºC, and within its optimum energy range (10-1000 keV) it provides a comfortable resolution of  about 2 to 3 keV. However ir should be noted that CdTe detectors have inferior stopping power to regular scintillator detectors.

Several tests have already been done with prototype CdTe-PET scanners, and the results so far have been quite promising. It has already been shown to better characterize partial epilepsy and nasopharyngeal cancer than a standard scintillator PET design, thanks both to the increased energy, and therefore spatial resolution of the detector:

![alt text][tumors]{: .center-image }

*Takeuchi W. et al. (2016) Semiconductor Detector-Based Scanners for Nuclear Medicine. In: Kuge Y., Shiga T., Tamaki N. (eds) Perspectives on Nuclear Medicine for Molecular Diagnosis and Integrated Therapy. Springer, Tokyo*
{: style="color:gray; font-size: 80%; text-align: center;"}

With all this info, we can return to the question of what are these things over here:

![alt text][mechanismLargerScaleZoom]{: .center-image }

Currently they are a scintillator / PMT combo, but in the future, maybe not.

LOOK AT SIPMS AND STUFF LIKE THAT IN KNOLL

PROBABLY JUST EXPAND THIS SECTION IN GENERAL


#### <a name = "2.1.3">2.1.3. The signal obtained</a>

[wellBehavedSignal]:       {{ "/assets/2017-11-05-PET/wellBehavedSignal.png" | absolute_url }}
[PMToutput]:               {{ "/assets/2017-11-05-PET/PMToutput.png" | absolute_url }}
[coincidenceDetection]:    {{ "/assets/2017-11-05-PET/coincidenceDetection.png" | absolute_url }}
[sinogram1]:               {{ "/assets/2017-11-05-PET/causes-of-noise-in-pet-imaging-4-638.jpg" | absolute_url }}
[sinogram2]:               {{ "/assets/2017-11-05-PET/technologies-05-00037-g001.png" | absolute_url }}
[backprojection]:          {{ "/assets/2017-11-05-PET/fig15a.JPG" | absolute_url }}
[filters]:                 {{ "/assets/2017-11-05-PET/filters.png" | absolute_url }}
[filteredBackprojection]:  {{ "/assets/2017-11-05-PET/additional-material-24-638.jpg" | absolute_url }}
[reconstructionContents]:  {{ "/assets/2017-11-05-PET/reconstructionContents.png" | absolute_url }}
[iterativeReconstruction]: {{ "/assets/2017-11-05-PET/iterativeReconstruction.png" | absolute_url }}
[reconstructionCompar]:    {{ "/assets/2017-11-05-PET/reconstructionComparison.png" | absolute_url }}

So in [2.1.1.](#2.1.1) we determined that we could make use of the unscattered electron-positron annihilation photons to obtain a very good estimate of where the decay of a tracer occured, and in [2.1.2.](#2.1.2) we found what kind of detectors we need in order to capture the photons and convert them to an electrical signal. Now we're going to talk about how a set of well-behaved signals gets translated into a tomography showing the spatial density of radioactive decays.

Before going into that topic let's just quickly clarify what we mean by a well-behaved signal. A well-behaved signal in this case is one where neither of the photons suffer any scatter, and then they both get fully absorbed by the detector and register on the photomultiplier, having been successfully translated into an electric pulse. Also let's suppose that the annihilation happens roughly at the center of the scanner, or more specifically, the center of its Field Of View (FOV). So something like this:

![alt text][wellBehavedSignal]{: .center-image }

In order to have all the information necessary for reconstruction of a tomography we just need to somehow register many of those green lines in the image. Again, this means that we want to extract the aforementioned Line Of Response (LOR). How can we achieve that? And how do we even know that what has been detected was in fact an annihilation event? Well, notice that the "photomultipliers" in this example have both "become yellow" at the same time. Do not notice that the PET scanner is like 10 atoms across. Since for a well-behaved signal we have a "simultaneous" detection of two gammas -- ie a *coincidence* -- we can make use of that signature to identify an annihilation event. Meanwhile there is but a single path that the annihilation photons of a well-behaved event can take in order to be caught by those two particular detectors, and that corresponds to the shortest possible path between the two "yellowed PMTs", ie a straight line between them. So we can register that very same path as our LOR. With that established, now all we need is to have an electronic setup that notices when two detectors are set off in a short time window in order to be able to store all the information necessary to reconstruct the tomography. 

For reference, this is what the output of the photomultiplier looks like:

![alt text][PMToutput]{: .center-image }

*source: Mao et. al. , Optical and Scintillation Properties of Inorganic Scintillators in High Energy Physics*
{: style="color:gray; font-size: 80%; text-align: center;"}

And this is a rough representation of what is used for coincidence detection:

![alt text][coincidenceDetection]{: .center-image }

*source: S. R. Cherry, M. Dahlbom, PET: Physics, Instrumentation and Scanners*
{: style="color:gray; font-size: 80%; text-align: center;"}

In case you're wondering, the \\(\tau\\) that shows up in the two images is the width of the logic pulses that are emitted by the Pulse Height Analyzer, or PHA for short. The width of the pulse corrseponds to the FWHM of the scintillator output. The job of the PHA is to discriminate whether the amplified pulse (hence the Amp. before it) corresponds to something that was potentially an unscattered annihilation photon. So basically the PHA serves as an energy window and the coincidence detector is a time window. What the coincidence detector does is it integrates the AND value of the two inputs over \\(2\tau\\). If the result is nonzero, then that gets registered as a count.

And that's the coincidence electronics explained. Now we're registering all the LORs that occur throughout the reading. How can we translate these into something tangible like a tomogaphy, though? Well, that's not really of much interest for IFR, so I'll just let a few pictures do the explaining:

![alt text][sinogram1]{: .center-image }

![alt text][sinogram2]{: .center-image }

![alt text][backprojection]{: .center-image }

![alt text][filters]{: .center-image }

*source: G. B. Saha, Basics of PET Imaging 2nd Ed., Springer*
{: style="color:gray; font-size: 80%; text-align: center;"}

![alt text][filteredBackprojection]{: .center-image }

![alt text][reconstructionContents]{: .center-image }

*source: G. B. Saha, Basics of PET Imaging 2nd Ed., Springer*
{: style="color:gray; font-size: 80%; text-align: center;"}

![alt text][iterativeReconstruction]{: .center-image }

*source: G. B. Saha, Basics of PET Imaging 2nd Ed., Springer*
{: style="color:gray; font-size: 80%; text-align: center;"}

![alt text][reconstructionCompar]{: .center-image }

*source: G. B. Saha, Basics of PET Imaging 2nd Ed., Springer*
{: style="color:gray; font-size: 80%; text-align: center;"}

Aaaaaaaaaand that's the whole mechanism of PET explained! Hope you liked it, beeyotch. Onto uses for PET and types of PET scanners.

#### <a name = "2.1.4">2.1.4. Uses / Types of PET</a>

[uses]:      {{ "/assets/2017-11-05-PET/uses.png" | absolute_url }}
[personPET]: {{ "/assets/2017-11-05-PET/PET-Scanner-640x353.jpg" | absolute_url }}
[mousePET]:  {{ "/assets/2017-11-05-PET/PCIF_SmallanimalPET-CT.jpg" | absolute_url }}
[mousePET2]: {{ "/assets/2017-11-05-PET/smallAnimalPet.png" | absolute_url }}

Now that the part that is really important for physicists is explained, the rest is going to positively whizz by. What are the uses for PET? Let's check wikipedia:

![alt text][uses]{: .center-image }

Got it! What are the kinds of PET? There's the big ones for people, and then there's the small ones for rodents, for preclinical purposes. They have different resolution requirements. I mean, obviously.

![alt text][personPET]{: .center-image }

PET scanner
{: style="color:gray; font-size: 80%; text-align: center;"}

![alt text][mousePET]{: .center-image }

small animal PET scanner
{: style="color:gray; font-size: 80%; text-align: center;"}

![alt text][mousePET2]{: .center-image }

small small animal PET scanner
{: style="color:gray; font-size: 80%; text-align: center;"}

## <a name="2.2">2.2. How Well Does it Work? </a>


# <a name= "3">lab application</a>

# <a name= "4">concluision</a>
